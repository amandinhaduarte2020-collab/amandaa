<!-- FILE: templates/base.html -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Elegância Premium - Sistema de Gestão{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    {% block extra_css %}{% endblock %}
</head>
<body>
    {% if session.get('logado') %}
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-logo">
                <i class="fas fa-store"></i> Elegância Premium
            </div>
            <ul class="navbar-menu">
                <li><a href="{{ url_for('dashboard') }}"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                <li><a href="{{ url_for('clientes') }}"><i class="fas fa-users"></i> Clientes</a></li>
                {% if session.get('permissao') in ['GERENTE', 'ESTOQUISTA'] %}
                <li><a href="{{ url_for('estoque') }}"><i class="fas fa-boxes"></i> Estoque</a></li>
                {% endif %}
                {% if session.get('permissao') in ['GERENTE', 'VENDEDOR'] %}
                <li><a href="{{ url_for('vendas') }}"><i class="fas fa-shopping-cart"></i> Vendas</a></li>
                {% endif %}
                {% if session.get('permissao') == 'GERENTE' %}
                <li><a href="{{ url_for('relatorios') }}"><i class="fas fa-chart-bar"></i> Relatórios</a></li>
                {% endif %}
            </ul>
            <div class="navbar-user">
                <span>{{ session.get('nome', 'Usuário') }}</span>
                <a href="{{ url_for('logout') }}" class="btn btn-sm btn-danger">Sair</a>
            </div>
        </div>
    </nav>
    {% endif %}

    <div class="container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible">
                    {{ message }}
                    <button type="button" class="close" data-dismiss="alert">&times;</button>
                </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    {% block extra_js %}{% endblock %}
</body>
</html>

<!-- FILE: templates/login.html -->
{% extends "base.html" %}

{% block title %}Login - Elegância Premium{% endblock %}

{% block content %}
<div class="login-container">
    <div class="login-box">
        <div class="login-header">
            <i class="fas fa-store"></i>
            <h1>Elegância Premium</h1>
            <p>Sistema de Gestão de Vendas</p>
        </div>

        {% if erro %}
        <div class="alert alert-danger">{{ erro }}</div>
        {% endif %}

        <form method="POST" action="{{ url_for('login') }}" class="login-form">
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" class="form-control" required>
            </div>

            <div class="form-group">
                <label for="senha">Senha:</label>
                <input type="password" id="senha" name="senha" class="form-control" required>
            </div>

            <button type="submit" class="btn btn-primary btn-block">Entrar</button>
        </form>

        <div class="login-footer">
            <p><strong>Usuários para teste:</strong></p>
            <p>Email: maria@elegancia.com | Senha: senha123</p>
            <p>Email: carlos@elegancia.com | Senha: senha123</p>
            <p>Email: patricia@elegancia.com | Senha: senha123</p>
        </div>
    </div>
</div>
{% endblock %}

<!-- FILE: templates/dashboard.html -->
{% extends "base.html" %}

{% block title %}Dashboard - Elegância Premium{% endblock %}

{% block content %}
<div class="dashboard">
    <h1><i class="fas fa-tachometer-alt"></i> Dashboard</h1>

    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon stat-icon-blue">
                <i class="fas fa-shopping-cart"></i>
            </div>
            <div class="stat-content">
                <h3>{{ total_vendas }}</h3>
                <p>Vendas Concluídas</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon stat-icon-green">
                <i class="fas fa-dollar-sign"></i>
            </div>
            <div class="stat-content">
                <h3>R$ {{ valor_vendas }}</h3>
                <p>Valor Total de Vendas</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon stat-icon-purple">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
                <h3>{{ total_clientes }}</h3>
                <p>Clientes Ativos</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon stat-icon-red">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="stat-content">
                <h3>{{ produtos_baixos }}</h3>
                <p>Produtos com Estoque Baixo</p>
            </div>
        </div>
    </div>

    <div class="content-grid">
        <div class="card">
            <div class="card-header">
                <h2>Atalhos Rápidos</h2>
            </div>
            <div class="card-body">
                <div class="quick-links">
                    <a href="#" class="quick-link-btn">
                        <i class="fas fa-user-plus"></i>
                        <span>Novo Cliente</span>
                    </a>
                    <a href="#" class="quick-link-btn">
                        <i class="fas fa-plus-circle"></i>
                        <span>Nova Venda</span>
                    </a>
                    <a href="#" class="quick-link-btn">
                        <i class="fas fa-undo"></i>
                        <span>Nova Devolução</span>
                    </a>
                    <a href="#" class="quick-link-btn">
                        <i class="fas fa-chart-line"></i>
                        <span>Relatórios</span>
                    </a>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2>Informações do Sistema</h2>
            </div>
            <div class="card-body">
                <ul class="info-list">
                    <li><strong>Usuário:</strong> {{ session.get('nome', 'N/A') }}</li>
                    <li><strong>Permissão:</strong> {{ session.get('permissao', 'N/A') }}</li>
                    <li><strong>Email:</strong> {{ session.get('email', 'N/A') }}</li>
                    <li><strong>Data/Hora:</strong> <span id="datetime"></span></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
    // Atualizar data/hora em tempo real
    function atualizarDataHora() {
        const agora = new Date().toLocaleString('pt-BR');
        document.getElementById('datetime').textContent = agora;
    }
    atualizarDataHora();
    setInterval(atualizarDataHora, 1000);
</script>
{% endblock %}

<!-- FILE: templates/clientes.html -->
{% extends "base.html" %}

{% block title %}Clientes - Elegância Premium{% endblock %}

{% block content %}
<div class="clientes-page">
    <div class="page-header">
        <h1><i class="fas fa-users"></i> Clientes</h1>
        <button class="btn btn-primary" data-toggle="modal" data-target="#modalNovoCliente">
            <i class="fas fa-user-plus"></i> Novo Cliente
        </button>
    </div>

    <div class="card">
        <div class="card-header">
            <input type="text" id="filtroClientes" placeholder="Filtrar por nome ou CPF..." class="form-control">
        </div>
        <div class="card-body">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>CPF</th>
                        <th>Email</th>
                        <th>Telefone</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="tabelaClientes">
                    <tr><td colspan="5" class="text-center">Carregando...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal Novo Cliente -->
<div class="modal" id="modalNovoCliente">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5>Novo Cliente</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <form id="formNovoCliente">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="nomeCiente">Nome:</label>
                        <input type="text" id="nomeCliente" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="cpfCliente">CPF:</label>
                        <input type="text" id="cpfCliente" class="form-control" placeholder="00000000000" required>
                    </div>
                    <div class="form-group">
                        <label for="emailCliente">Email:</label>
                        <input type="email" id="emailCliente" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="telefoneCliente">Telefone:</label>
                        <input type="text" id="telefoneCliente" class="form-control" placeholder="11999999999">
                    </div>
                    <div class="form-group">
                        <label for="enderecoCliente">Endereço:</label>
                        <textarea id="enderecoCliente" class="form-control" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar Cliente</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // Carregar clientes
    function carregarClientes() {
        fetch('/api/clientes')
            .then(response => response.json())
            .then(clientes => {
                const tbody = document.getElementById('tabelaClientes');
                tbody.innerHTML = '';
                
                if (clientes.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="text-center">Nenhum cliente encontrado</td></tr>';
                    return;
                }
                
                clientes.forEach(cliente => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${cliente.nome}</td>
                        <td>${cliente.cpf}</td>
                        <td>${cliente.email || '-'}</td>
                        <td>${cliente.telefone || '-'}</td>
                        <td>
                            <button class="btn btn-sm btn-info" onclick="editarCliente(${cliente.id_cliente})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deletarCliente(${cliente.id_cliente})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            });
    }

    // Novo cliente
    document.getElementById('formNovoCliente').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const dados = {
            nome: document.getElementById('nomeCliente').value,
            cpf: document.getElementById('cpfCliente').value,
            email: document.getElementById('emailCliente').value,
            telefone: document.getElementById('telefoneCliente').value,
            endereco: document.getElementById('enderecoCliente').value
        };
        
        fetch('/api/clientes', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(dados)
        })
        .then(response => {
            if (response.ok) {
                alert('Cliente cadastrado com sucesso!');
                $('#modalNovoCliente').modal('hide');
                this.reset();
                carregarClientes();
            } else {
                alert('Erro ao cadastrar cliente');
            }
        });
    });

    // Carregar clientes ao abrir página
    carregarClientes();
</script>
{% endblock %}

<!-- FILE: templates/estoque.html -->
{% extends "base.html" %}

{% block title %}Estoque - Elegância Premium{% endblock %}

{% block content %}
<div class="estoque-page">
    <div class="page-header">
        <h1><i class="fas fa-boxes"></i> Controle de Estoque</h1>
    </div>

    <div class="card">
        <div class="card-header">
            <div class="filtros">
                <input type="text" id="filtroProduto" placeholder="Filtrar por produto..." class="form-control">
                <select id="filtroColecao" class="form-control">
                    <option value="">Todas as coleções</option>
                </select>
            </div>
        </div>
        <div class="card-body">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>SKU</th>
                        <th>Produto</th>
                        <th>Coleção</th>
                        <th>Cor</th>
                        <th>Tamanho</th>
                        <th>Quantidade</th>
                        <th>Mínima</th>
                        <th>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="tabelaEstoque">
                    <tr><td colspan="9" class="text-center">Carregando...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal Atualizar Estoque -->
<div class="modal" id="modalAtualizarEstoque">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5>Atualizar Estoque</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <form id="formAtualizarEstoque">
                <div class="modal-body">
                    <div class="form-group">
                        <label>SKU: <span id="labelSKU"></span></label>
                    </div>
                    <div class="form-group">
                        <label for="quantidadeEstoque">Quantidade:</label>
                        <input type="number" id="quantidadeEstoque" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="motivo">Motivo:</label>
                        <input type="text" id="motivo" class="form-control" placeholder="Reposição, Ajuste, etc">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Atualizar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    let idVariacaoSelecionada = null;

    function carregarEstoque() {
        fetch('/api/estoque')
            .then(response => response.json())
            .then(estoque => {
                const tbody = document.getElementById('tabelaEstoque');
                tbody.innerHTML = '';
                
                if (estoque.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="9" class="text-center">Nenhum produto encontrado</td></tr>';
                    return;
                }
                
                estoque.forEach(item => {
                    const status = item.quantidade_estoque <= item.quantidade_minima ? 
                        '<span class="badge badge-danger">Baixo</span>' : 
                        '<span class="badge badge-success">Ok</span>';
                    
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td><code>${item.sku}</code></td>
                        <td>${item.produto_nome}</td>
                        <td>${item.colecao_nome}</td>
                        <td>${item.cor_nome}</td>
                        <td>${item.tamanho_valor}</td>
                        <td>${item.quantidade_estoque}</td>
                        <td>${item.quantidade_minima}</td>
                        <td>${status}</td>
                        <td>
                            <button class="btn btn-sm btn-warning" onclick="abrirModalAtualizarEstoque(${item.id_variacao}, '${item.sku}', ${item.quantidade_estoque})">
                                <i class="fas fa-edit"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            });
    }

    function abrirModalAtualizarEstoque(idVariacao, sku, quantidade) {
        idVariacaoSelecionada = idVariacao;
        document.getElementById('labelSKU').textContent = sku;
        document.getElementById('quantidadeEstoque').value = quantidade;
        $('#modalAtualizarEstoque').modal('show');
    }

    document.getElementById('formAtualizarEstoque').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const dados = {
            quantidade_estoque: parseInt(document.getElementById('quantidadeEstoque').value),
            motivo: document.getElementById('motivo').value
        };
        
        fetch(`/api/estoque/${idVariacaoSelecionada}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(dados)
        })
        .then(response => {
            if (response.ok) {
                alert('Estoque atualizado com sucesso!');
                $('#modalAtualizarEstoque').modal('hide');
                carregarEstoque();
            } else {
                alert('Erro ao atualizar estoque');
            }
        });
    });

    carregarEstoque();
</script>
{% endblock %}

<!-- FILE: templates/vendas.html -->
{% extends "base.html" %}

{% block title %}Vendas - Elegância Premium{% endblock %}

{% block content %}
<div class="vendas-page">
    <div class="page-header">
        <h1><i class="fas fa-shopping-cart"></i> Vendas</h1>
        <button class="btn btn-primary" data-toggle="modal" data-target="#modalNovaVenda">
            <i class="fas fa-plus-circle"></i> Nova Venda
        </button>
    </div>

    <div class="card">
        <div class="card-body">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>ID Venda</th>
                        <th>Data</th>
                        <th>Cliente</th>
                        <th>Vendedor</th>
                        <th>Valor Total</th>
                        <th>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="tabelaVendas">
                    <tr><td colspan="7" class="text-center">Carregando...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal Nova Venda -->
<div class="modal" id="modalNovaVenda">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5>Nova Venda</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <form id="formNovaVenda">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="clienteVenda">Cliente:</label>
                        <select id="clienteVenda" class="form-control" required></select>
                    </div>
                    <div class="form-group">
                        <label for="produtoVenda">Produto:</label>
                        <select id="produtoVenda" class="form-control" required></select>
                    </div>
                    <div class="form-group">
                        <label for="corVenda">Cor:</label>
                        <select id="corVenda" class="form-control"></select>
                    </div>
                    <div class="form-group">
                        <label for="tamanhoVenda">Tamanho:</label>
                        <select id="tamanhoVenda" class="form-control"></select>
                    </div>
                    <div class="form-group">
                        <label for="quantidadeVenda">Quantidade:</label>
                        <input type="number" id="quantidadeVenda" class="form-control" min="1" value="1">
                    </div>
                    <div class="form-group">
                        <label for="precoVenda">Preço Unitário:</label>
                        <input type="number" id="precoVenda" class="form-control" step="0.01" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Registrar Venda</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    function carregarVendas() {
        fetch('/api/vendas')
            .then(response => response.json())
            .then(vendas => {
                const tbody = document.getElementById('tabelaVendas');
                tbody.innerHTML = '';
                
                if (vendas.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" class="text-center">Nenhuma venda encontrada</td></tr>';
                    return;
                }
                
                vendas.forEach(venda => {
                    const data = new Date(venda.data_venda).toLocaleDateString('pt-BR');
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>#${venda.id_venda}</td>
                        <td>${data}</td>
                        <td>${venda.cliente}</td>
                        <td>${venda.vendedor}</td>
                        <td>R$ ${parseFloat(venda.valor_total).toFixed(2)}</td>
                        <td><span class="badge badge-${venda.status === 'CONCLUIDA' ? 'success' : 'danger'}">${venda.status}</span></td>
                        <td>
                            <button class="btn btn-sm btn-info" onclick="verDetalhesVenda(${venda.id_venda})">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            });
    }

    // Carregar clientes e produtos
    function carregarSelects() {
        fetch('/api/clientes')
            .then(response => response.json())
            .then(clientes => {
                const select = document.getElementById('clienteVenda');
                clientes.forEach(cliente => {
                    const option = document.createElement('option');
                    option.value = cliente.id_cliente;
                    option.textContent = `${cliente.nome} (${cliente.cpf})`;
                    select.appendChild(option);
                });
            });
    }

    document.getElementById('formNovaVenda').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const dados = {
            id_cliente: document.getElementById('clienteVenda').value,
            itens: [{
                id_variacao: 1, // Simplificado para exemplo
                quantidade: document.getElementById('quantidadeVenda').value,
                preco_unitario: document.getElementById('precoVenda').value
            }]
        };
        
        fetch('/api/vendas', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(dados)
        })
        .then(response => {
            if (response.ok) {
                alert('Venda registrada com sucesso!');
                $('#modalNovaVenda').modal('hide');
                this.reset();
                carregarVendas();
            } else {
                alert('Erro ao registrar venda');
            }
        });
    });

    carregarSelects();
    carregarVendas();
</script>
{% endblock %}